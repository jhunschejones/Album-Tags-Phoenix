var listPage={initializeSelectElement:function(){var a=document.querySelectorAll("select");a=M.FormSelect.init(a,{});listPage.existingListsSelect=a[0];listPage.existingListsSelect.dropdown.options.onCloseStart=function(){var a=(document.getElementsByClassName("select-dropdown")[0].offsetWidth-30)/6.75,b=document.getElementsByClassName("select-dropdown")[0].value;b.length>a&&(document.getElementsByClassName("select-dropdown")[0].value=truncate(b,a))};document.addEventListener("click",function(a){a.target.classList.contains("select-dropdown")||
listPage.existingListsSelect.dropdown.close()})},closeToast:function(){var a=document.querySelector(".toast");M.Toast.getInstance(a).dismiss()},closeToastsOnClick:function(a){a=a.target.parentNode;(a.classList&&a.classList.contains("toast")||"toast-container"==a.id)&&listPage.closeToast()},addAlbumToExistingList:function(){var a=listPage.existingListsSelect.getSelectedValues()[0];if(""!==a){if("favorites"===a)return listPage.addAlbumToFavoritesList();var c=parseInt((new URLSearchParams(window.location.search)).get("album")),
b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState)if(200<=b.status&&300>b.status){listPage.existingListsSelect.destroy();document.getElementById("placeholder").selected=!0;listPage.initializeSelectElement();var a=JSON.parse(b.responseText);M.toast({html:a.message})}else listPage.existingListsSelect.destroy(),document.getElementById("placeholder").selected=!0,listPage.initializeSelectElement(),M.toast({html:b.responseText.replace(/"/g,"")})};b.open("PATCH","/lists/"+a);b.setRequestHeader("Content-Type",
"application/json");b.setRequestHeader("X-CSRF-Token",CSRF_TOKEN);b.send(JSON.stringify({action:"add_album",currentAlbum:c}))}},addAlbumToFavoritesList:function(){var a=parseInt((new URLSearchParams(window.location.search)).get("album")),c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&(listPage.existingListsSelect.destroy(),document.getElementById("placeholder").selected=!0,listPage.initializeSelectElement(),M.toast({html:c.responseText.replace(/"/g,"")}))};c.open("PATCH","/lists/favorites");
c.setRequestHeader("Content-Type","application/json");c.setRequestHeader("X-CSRF-Token",CSRF_TOKEN);c.send(JSON.stringify({action:"add_favorite",currentAlbum:a}))},addAlbumToNewList:function(){var a=document.getElementById("new-list-name").value.trim(),c=parseInt((new URLSearchParams(window.location.search)).get("album")),b=new XMLHttpRequest;b.onreadystatechange=function(){4===b.readyState&&(200<=b.status&&300>b.status&&(document.getElementById("new-list-name").value=""),M.toast({html:b.responseText.replace(/"/g,
"")}))};b.open("POST","/lists");b.setRequestHeader("Content-Type","application/json");b.setRequestHeader("X-CSRF-Token",CSRF_TOKEN);b.send(JSON.stringify({currentAlbum:c,private:!1,title:a}))}};function truncate(a,c){if(-1==a.lastIndexOf(" "))return a.substr(0,c-9)+"...";a=a.substr(0,c-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}
(function(){document.addEventListener("DOMContentLoaded",function(){listPage.initializeSelectElement();document.addEventListener("click",function(a){listPage.closeToastsOnClick(a)},{passive:!0});var a=document.getElementById("add-to-list-btn"),c=document.getElementById("add-to-new-list-btn"),b=document.getElementById("new-list-name");a.addEventListener("click",listPage.addAlbumToExistingList);c.addEventListener("click",listPage.addAlbumToNewList);b.addEventListener("keyup",function(a){13===a.keyCode&&
c.click()},{passive:!0})},{passive:!0})})();
